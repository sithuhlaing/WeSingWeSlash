{"version":3,"sources":["PlayerCtrl.js"],"names":["cc","Class","extends","Component","properties","canvas","default","type","Node","player","rocketInactive","rocketActive","rocketParticle","speedX","speedY","bLeft","bRight","bTop","rocketAudio","url","AudioClip","onLoad","spine","getComponent","sp","Skeleton","isRocketLaunch","nodeDestroyed","director","getPhysicsManager","enabled","getCollisionManager","console","log","goLeft","goRight","jump","interact","_up","body","node","RigidBody","registerInput","that","eventManager","addListener","event","EventListener","KEYBOARD","onKeyPressed","keyCode","KEY","a","scaleX","_walk","setAnimation","d","space","onKeyReleased","update","dt","x","y","v2","linearVelocity","onCollisionEnter","other","group","game","groupList","groupIndex","opacity","scheduleOnce","rocketInActive","active","rocketParticlePlay","sceneFadeOut","rocketLaunch","playAudioId","audioEngine","play","changeScene","particle","ParticleSystem","particleCount","stopSystem","resetSystem","myNode","fadeIn_action","fadeIn","delay_action","delayTime","fadeOut_action","fadeOut","fadeInOut","sequence","runAction","stop","loadScene"],"mappings":"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","file":"PlayerCtrl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        canvas : {\n            default : null,\n            type : cc.Node,\n        },\n        player : {\n            default : null,\n            type : cc.Node,\n        },\n        rocketInactive : {\n                 default : null,\n                 type : cc.Node,\n        },\n        rocketActive : {\n                 default : null,\n                 type : cc.Node,\n        },\n        rocketParticle : {\n            default : null,\n            type : cc.Node,\n        },\n       \n        speedX: 0,\n        speedY: 0,\n        bLeft: 0,\n        bRight: 0,\n        bTop: 0,\n        rocketAudio:{\n            default: null,\n            url: cc.AudioClip,\n        },\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.spine = this.getComponent(sp.Skeleton);\n        this.isRocketLaunch = false;\n        this.nodeDestroyed = false;\n        cc.director.getPhysicsManager().enabled = true;\n        cc.director.getCollisionManager().enabled = true;\n        \n        console.log(this.spine);\n        \n        this.goLeft = false;\n        this.goRight = false;\n        this.jump = false;\n        this.interact = false;    \n        \n        this._up = false;\n        this.body = this.node.getComponent(cc.RigidBody);\n        this.registerInput();\n    },\n\n    registerInput () {\n        var that = this;\n        // Keyboard\n        cc.eventManager.addListener({\n            event: cc.EventListener.KEYBOARD,\n            onKeyPressed: function(keyCode, event) {\n                if (keyCode == cc.KEY.a && !this.nodeDestroyed) {\n                    that.goLeft = true;\n                    that.goRight = false;\n                    if (that.node.scaleX < 0)\n                        that.node.scaleX *= -1;\n\n                    if (!that._walk) {\n                        that.spine.setAnimation(0, \"walking fast\", true);\n                        that._walk = true;\n                    }\n                }\n                else if (keyCode == cc.KEY.d && !this.nodeDestroyed) {\n                    that.goRight = true;\n                    that.goLeft = false;\n                    if (that.node.scaleX > 0)\n                        that.node.scaleX *= -1; \n\n                    if (!that._walk) {\n                        that.spine.setAnimation(0, \"walking fast\", true);\n                        that._walk = true;\n                    }\n                }\n                else if (keyCode == cc.KEY.space && !this.nodeDestroyed) {\n                    if (!that.jump) {\n                        that.jump = true;\n                    }\n                }\n                \n            },\n\n            onKeyReleased: function(keyCode, event) {\n                if (keyCode == cc.KEY.a && !this.nodeDestroyed) {\n                    that.goLeft = false;\n\n                    if (that._walk) {\n                        that.spine.setAnimation(0, \"idel\", true);\n                        that._walk = false;\n                    }\n                }\n                else if (keyCode == cc.KEY.d && !this.nodeDestroyed) {\n                    that.goRight = false;\n\n                    if (that._walk) {\n                        that.spine.setAnimation(0, \"idel\", true);\n                        that._walk = false;\n                    }\n                }\n                else if (keyCode == cc.KEY.space && !this.nodeDestroyed) {\n                    if (!that.jump) {\n                        that.jump = false;\n                    }\n                }\n            },\n        }, this.node);\n    },\n\n\n    // called every frame, uncomment this function to activate update callback\n     update: function (dt) {\n        if (this.goLeft && this.node.x > this.bLeft) {\n            this.node.x -= this.speedX * dt;\n        }\n        else if (this.goRight && this.node.x < this.bRight) {\n            this.node.x += this.speedX * dt;\n        }\n        \n        if (this.jump && this.node.y < this.bTop) {\n            var v2 = cc.v2(0, (200 * dt * 50));\n            this.jump = false;\n            this.body.linearVelocity = v2;\n            cc.log(this.body.linearVelocity);\n        }\n\n        if (this.isRocketLaunch){\n            this.rocketActive.y += 200 * dt;\n            this.rocketParticle.y += 100 * dt;\n        }\n    },\n\n    onCollisionEnter: function (other) {\n        var group = cc.game.groupList[other.node.groupIndex];\n        if (group == \"Obstacle\") {\n           \n           this.spine.enabled = false;\n           this.node.opacity = 0;\n           this.nodeDestroyed = true;\n           this.scheduleOnce(this.rocketInActive,1);\n        }\n    },\n\n    rocketInActive: function (){\n        this.rocketInactive.active = false;\n        this.rocketActive.active = true;\n        this.scheduleOnce(this.rocketParticlePlay,1);\n        this.scheduleOnce(this.sceneFadeOut,1.5)\n    },\n\n    rocketLaunch: function() {\n        this.isRocketLaunch = true;\n        this.playAudioId=cc.audioEngine.play(this.rocketAudio,false,1)\n        this.scheduleOnce(this.changeScene,5);\n    },\n\n    rocketParticlePlay: function(){\n        this.rocketParticle.active = true;\n        \n        var particle = this.rocketParticle.getComponent(cc.ParticleSystem);\n        if (particle.particleCount > 0) {\n            particle.stopSystem();\n        } else {\n            particle.resetSystem();\n        }\n\n        this.scheduleOnce(this.rocketLaunch,1);\n       \n    },\n\n    sceneFadeOut: function(myNode) {\n        var fadeIn_action = new cc.fadeIn(1);\n        var delay_action = new cc.delayTime(1);\n        var fadeOut_action = new cc.fadeOut(3);\n        var fadeInOut = new cc.sequence(fadeIn_action, delay_action, fadeOut_action);\n        this.canvas.runAction(fadeInOut);\n        },\n\n        changeScene : function(){\n            cc.audioEngine.stop(this.playAudioId);\n            cc.director.loadScene('EndScene');\n    },\n\n    \n\n     \n});\n"]}